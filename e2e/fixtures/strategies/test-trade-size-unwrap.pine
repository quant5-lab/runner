//@version=5
strategy("Trade Size Unwrap Test", overlay=true, initial_capital=10000, default_qty_type=strategy.cash, default_qty_value=1000)

// Test 1: Fixed quantity entry (should be numeric)
qty_fixed = 1.5
strategy.entry("entry_fixed", strategy.long, qty=qty_fixed, when=close > 0)

// Test 2: Input-based quantity (tests input unwrapping)
qty_input = input(2.5, "Input Quantity")
strategy.entry("entry_input", strategy.long, qty=qty_input, when=close > 0)

// Test 3: Calculated quantity (tests param wrapping)
qty_calc = close > close[1] ? 3.0 : 2.0
strategy.entry("entry_calc", strategy.long, qty=qty_calc, when=close > 0)

// Close to complete trades after some bars
has_position = strategy.position_size != 0
close_signal = has_position
if close_signal
    strategy.close_all()

// Debug plots
plot(strategy.position_size, "Position Size", color=color.blue)
plot(strategy.equity, "Equity", color=color.green, pane="equity")
