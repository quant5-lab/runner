//@version=4
study(title="BB7 Dissect: 1D S&R Detection", shorttitle="BB7-1D-SR", overlay=true)

// Isolate 1D Support & Resistance detection mechanism
use_1d_sr = input(true, title='Auto detection of S&R', type=input.bool)
leftBars  = input(15, title = "SR Left Bars ")
rightBars  = input(15, title = "SR Right Bars")

// Core 1D pivot detection with security()
highUsePivot = security(syminfo.tickerid, "1D", fixnan(pivothigh(leftBars, rightBars)[1]))
lowUsePivot = security(syminfo.tickerid, "1D", fixnan(pivotlow(leftBars, rightBars)[1]))

// Visual output
r1 = plot(highUsePivot, color=change(highUsePivot) ? na : color.red,  linewidth=3, offset=-(rightBars+1), title="Resistance")
s1 = plot(lowUsePivot, color=change(lowUsePivot) ? na : color.blue,  linewidth=3, offset=-(rightBars+1), title="Support")

// Assignment logic from original
closest_level_1 = use_1d_sr ? highUsePivot : na
closest_level_2 = use_1d_sr ? lowUsePivot : na

// Debug plots
plot(closest_level_1, color=color.orange, linewidth=1, title="Level 1")
plot(closest_level_2, color=color.purple, linewidth=1, title="Level 2")
